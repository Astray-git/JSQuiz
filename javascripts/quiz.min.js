function getJSON(){var e=new XMLHttpRequest;e.onreadystatechange=function(){4==this.readyState&&(this.status>=200&&this.status<300||304==this.status?(allQuestions=JSON.parse(this.response),qCount=allQuestions.length,CookieUtil.create("lastUser",CookieUtil.read("username"),7),quizInit()):console.log("Request was unsuccessful: "+this.status))},e.open("GET","quiz.json",!0),e.send(null),e=null}function getCookie(){var e=CookieUtil.read("username"),t=CookieUtil.read("lastUser");e?(welcomeText.appendChild(document.createTextNode(", "+e)),e!=t&&storage.clear()):welcomeText.appendChild(document.createTextNode(" to JS Quiz")),getJSON()}function quizInit(){curNum=1,tScore.length=qCount,qNumCur=document.createTextNode(curNum),qTextCur=document.createTextNode(allQuestions[0].question),qNum.appendChild(qNumCur),qText.appendChild(qTextCur),nextButton=new NavButton("next"),prevButton=new NavButton("prev"),nextButton.preHandler=function(){removeWarn(),qCount>curNum?choiceChk()&&this.quizNav(this.direction):choiceChk()&&(showResult(),fragQuiz.className="quiz-container hidden",fragResult.className="quiz-container",EventUtil.addHandler(retryBtn,"click",retryHandler))},question=new Question(curNum),question.showQuestion()}function getChoice(){var e,t,n=answer.getElementsByTagName("input"),a=null;for(e=0,t=n.length;t>e;e++)n[e].checked&&(a=n[e].value,storage.setItem("Q"+curNum,a));return a}function loadLocalChoice(e){var t=storage.getItem(e),n=answer.getElementsByTagName("input");t&&(n[t].checked=!0)}function choiceChk(){var e;switch(getChoice()){case cAns:e="1";break;case null:return showWarn(),EventUtil.addHandler(nextBtn,"click",btnClickHandler),!1;default:e="0"}return tScore[curNum-1]=e,!0}function Question(e){this.qNum=e,this.text=allQuestions[e-1].question,this.choices=allQuestions[e-1].choices,this.answer=allQuestions[e-1].correctAnswer.toString(),this.cLen=allQuestions[e-1].choices.length}function NavButton(e){this.direction=e}function retryHandler(e){e.target.removeEventListener(e.type,arguments.callee),EventUtil.preventDefault(e),retryUp()}function showResult(){removeAllChild(result,tsText);var e,t=0;for(e=1;qCount>=e;e++){var n=document.createElement("li"),a=document.createElement("i");"1"==tScore[e-1]?(a.className="fa fa-check",t++):"0"==tScore[e-1]&&(a.className="fa fa-times"),n.appendChild(a),result.appendChild(n)}var r=document.createTextNode(t+"/"+qCount);tsText.appendChild(r)}function quizReset(){fragQuiz.className="quiz-container",fragResult.className="quiz-container hidden",prevBtn.className="btn cir-r light hidden",removeAllChild(qNum,qText),tScore.length=0,storage.clear(),quizInit()}function removeWarn(){choiceWarn.className="warn hidden"}function showWarn(){choiceWarn.className="warn"}function getLocalStorage(){if("object"==typeof localStorage)return localStorage;if("object"==typeof globalStorage)return globalStorage[location.host];throw new Error("Local storage not available")}function removeAllChild(){var e,t;for(e=0,t=arguments.length;t>e;e++)for(;arguments[e].firstChild;)arguments[e].removeChild(arguments[e].firstChild)}function addLoadEvent(e){var t=window.onload;window.onload="function"!=typeof window.onload?e:function(){t(),e()}}var CookieUtil={create:function(e,t,n){if(n){var a=new Date;a.setTime(a.getTime()+24*n*60*60*1e3);var r="; expires="+a.toGMTString()}else var r="";document.cookie=e+"="+t+r+"; path=/"},read:function(e){for(var t=e+"=",n=document.cookie.split(";"),a=0;a<n.length;a++){for(var r=n[a];" "==r.charAt(0);)r=r.substring(1,r.length);if(0==r.indexOf(t))return r.substring(t.length,r.length)}return null},erase:function(e){createCookie(e,"",-1)}},EventUtil={addHandler:function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},getButton:function(e){if(document.implementation.hasFeature("MouseEvents","2.0"))return e.button;switch(e.button){case 0:case 1:case 3:case 5:case 7:return 0;case 2:case 6:return 2;case 4:return 1}},getCharCode:function(e){return"number"==typeof e.charCode?e.charCode:e.keyCode},getClipboardText:function(e){var t=e.clipboardData||window.clipboardData;return t.getData("text")},getEvent:function(e){return e?e:window.event},getRelatedTarget:function(e){return e.relatedTarget?e.relatedTarget:e.toElement?e.toElement:e.fromElement?e.fromElement:null},getTarget:function(e){return e.target||e.srcElement},getWheelDelta:function(e){return e.wheelDelta?client.engine.opera&&client.engine.opera<9.5?-e.wheelDelta:e.wheelDelta:40*-e.detail},preventDefault:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},removeHandler:function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=null},setClipboardText:function(e,t){e.clipboardData?e.clipboardData.setData("text/plain",t):window.clipboardData&&window.clipboardData.setData("text",t)},stopPropagation:function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}},allQuestions=null,qNum=document.getElementById("qnum"),qText=document.getElementsByClassName("qtext")[0],answer=document.getElementById("answer"),qContent=answer.parentNode,nextBtn=document.getElementById("next"),prevBtn=document.getElementById("prev"),result=document.getElementById("result"),tsText=document.getElementById("tsText"),retryBtn=document.getElementById("retry"),startBtn=document.getElementById("start"),fragQuiz=document.getElementById("frag-quiz"),fragResult=document.getElementById("frag-result"),fragWelcome=document.getElementsByClassName("welcome")[0],welcomeText=document.getElementsByClassName("wel-text")[0],choiceWarn=document.getElementById("choice-warn"),question=null,nextButton=null,prevButton=null,curNum=1,qCount,tScore=[],cAns=null,qNumCur=null,qTextCur=null;Question.prototype={constructor:Question,showQuestion:function(){qNumCur.nodeValue=this.qNum,qTextCur.nodeValue=this.text,removeAllChild(answer),EventUtil.removeHandler(answer,"click",this.choiceHandler);var e,t;for(e=1,t=this.cLen;t>=e;e++){var n=document.createElement("li");n.className="choice";var a=document.createElement("input");a.type="radio",a.value=e-1,a.name="answer",a.id="ci"+e;var r=document.createElement("label");r.setAttribute("for","ci"+e);var o=this.choices[e-1],i=document.createTextNode(o);r.appendChild(i),n.appendChild(a),n.appendChild(r),answer.appendChild(n)}cAns=this.answer,1==curNum?prevBtn.className="btn cir-r light hidden":"btn cir-r light"!=prevBtn.className&&(prevBtn.className="btn cir-r light"),loadLocalChoice("Q"+this.qNum),EventUtil.addHandler(answer,"click",this.choiceHandler),EventUtil.addHandler(nextBtn,"click",btnClickHandler),EventUtil.addHandler(prevBtn,"click",btnClickHandler)},choiceHandler:function(e){var t=EventUtil.getEvent(e),n=EventUtil.getTarget(t);Question.prototype.emChoice(n)},emChoice:function(e){"LI"==e.tagName&&(e.firstChild.checked=!0)}},NavButton.prototype={constructor:NavButton,preHandler:function(){removeWarn(),getChoice(),NavButton.prototype.quizNav(this.direction)},quizNav:function(e){switch(qContent.className="wcontent vhide",qContent.style.visibility="hidden",setTimeout(function(){qContent.style.visibility="visible",qContent.className="wcontent"},200),e){case"next":question=new Question(++curNum);break;case"prev":question=new Question(--curNum)}question.showQuestion()}};var btnClickHandler=function(e){e=EventUtil.getEvent(e);var t=EventUtil.getTarget(e);EventUtil.removeHandler(t,e.type,arguments.callee),EventUtil.preventDefault(e),"next"==t.id||"next"==t.parentNode.id?nextButton.preHandler():("prev"==t.id||"prev"==t.parentNode.id)&&prevButton.preHandler()},startUp=function(){var e=document.getElementsByClassName("blur-bg")[0],t=document.body;fragWelcome.className="welcome vhide",t.removeChild(e),t.className="",fragQuiz.className="quiz-container",setTimeout(function(){fragWelcome.className="welcome hidden"},100)},retryUp=function(){quizReset()};EventUtil.addHandler(startBtn,"click",function(e){EventUtil.preventDefault(e),EventUtil.removeHandler(startBtn,"click",arguments.callee),startUp()});var storage=getLocalStorage();addLoadEvent(getCookie);